Anytime you hear encryption for an AWS Service, its most likely KMS, AWS managed these encryption keys for us via KMS, fully integrated with IAM for authorization. Able to audit KMS key usage using CloudTrail. Symmetric (AES-256) uses single encryption key for encrypt and decrypt, used for operations which remain inside AWS via KMS API. Assymetric (RSA) keys use public private keys, used for encryption outside of AWS by users who can't call the KMS API.

Types of Keys are AWS Owned Keys, like SSE-S3, SSE-SQS, SSE-DDB (which are free), AWS Managed Key (als free) which start with aws/* e.g aws/rds or aws/ebs. Customer managed keys (CMK) created in KMS take 1$/month, while CMK imported also take 1$/month. AWS Managed KMS key auto-rotates every 1 year, Customer managed KMS can also auto-rotate on-demand (must be enabled) while Imported KMS key only has manual rotation using alias.

EBS volume encrypted with KMS Key A in region A can be copied to Region B by taking a snapshot (which will also be encrypted), then copy the snapshot to region B which is also encrypted but with KMS Key B (since 1 KMS key cannot live in the two regions), then restore the volume also encrypted with KMS key B.

You cannot access a KMS key if it doesn't have a KMS key policy in place (even if you have the IAM role for it). Default KMS key policy allows everyone complete access to the key in the account if they have permission to access KMS. Custom KMS key policy define users, roles that can access the KMS key, who can administer it and allows cross-account access of the key.

Cross-account KMS policy are used when for e.g a snapshot of EBS in account A is encrypted with KMS key, and the snapshot is copied to a different account B, then we create a copy of that snapshot with a CMK in account B then create a volume from the snapshot.

KMS Multi-Region Keys are identical KMS keys in different AWS Regions that can be used interchangeably. Multi-Region Keys have the same key ID, key material, automatic rotation. Encrypt in one region and decrypt in other regions so there is no need to re-encrypt or make cross-Region API calls. KMS Multi-region are NOT global (Primary key + Replica keys) and each multi-region key is managed independently. Use cases are global client-side encryption, encryption on Global DynamoDB, Global Aurora. In Global Aurora, we can encrypt specific attributes client-side in our Aurora table using the Encryption SDK, combined with Aurora Global Tables, the client-side encrypted data is replicated to other regions. If we use multi-region key, replicated in the same region as the Global Aurora DB, then clients in these regions can use low-latency API calls to KMS in their region to decrypt the data client-side.

S3 with unencrypted objects and objects with SSE-S3 are replicated by default, objects encrypted with SSE-C can be replicated. For objects encrypted with SSE-KMS, you need to enable the option. Specify which KMS Key to encrypt the objects with the target bucket, Adapt the KMS Key Policy for the target key. An IAM Role for S3 Replication service with kms:Decrypt for the source KMS key and kms:Encrypt for the target KMS Key. You might get KMS throttling errors because of too much encryption/decryption in which case you can ask for Service Quotas increase. We can use multi-region KMS key with S3 replication but they still will be treated as independent keys, meaning that the objects will still be decrypted at source and encrypted at destination.

To share an encrypted AMI with KMS in account A to account B, one must modify the image attribute to add a launch permission for the specified AWS account, also create a KMS key policy which allows cross account access. Then create an IAM role in account B which can access the KMS key info, and then we can create a ec2 instance in account B.

SSM Parameter Store is secure storage for configuration and secrets. Optional seamless encryption using KMS. Serverless, scalable, durable, easy SDK. Version tracking of configurations/secrets. Integrates with CloudFormation. Uses Filsystem like hierarchy and secrets are stored in /aws/reference/secretsmanager/secret_ID_Secrets_Manager

AWS Secrets Manager is meant for storing secrets, has capability to force rotation of secrets every X days, Automate generation of secrets on rotation using Lambda. Integration with RDS (MySQL, PostgreSQL, Aurora). Secrets are encrypted using KMS. In exam if it says "Storing secrets for RDS or integration with RDS for secrets" think AWS Secrets Manager. AWS Secrets Manager also has multi-region secrets by keeping read replicas in multiple regions in sync with primary secret. Read replica is promoted to standalone secret in case of primary failure. Use cases are multi-region DB, DR, multi-region apps.

AWS Certificate Manager (ACM) is used to easily provision, manage and deploy TLS certificates, TLS provide in-flight HTTPS encryption for sites. Supports both public/private TLS certificates and free of charge for public ones. Auto TLS cert renewal. Integrates with (load certs on) ELB, CloudFront Distributions, APIs on API Gateway. Can't use ACM with EC2. To request public certs from ACM, list the domains to be included in the cert (e.g FQDN or WildCard domain *.eg.com), Selection validation method (DNS validation or Email validation), DNS validation is preffered for auto renewal purposes, email does not have auto renewal. ACM generated certs are renewed 60 days before expiry. Public Certs could also be imported outside of ACM, no auto renewal and must import before expiry. ACM sends daily expiration notifications 45 days prior to expiry, Can also setup AWS config rule to send notifications for expiry. To Integrate ACM with API Gateway, Create a Custom Domain Name in API Gateway, then for Edge-Optimized where requests are routed from CloudFront Edge Locations, while API gateway will remain in one region (e.g eu-west-1), ACM TLS cert must be in the same region as CloudFront (e.g us-east-2) and then setup CNAME or A-Alias record in Route 53. Regional is for clients within same region, TLS cert must be imported on API Gateway and in same region as the API stage, then point to CNAME or A-ALias.

AWS WAF (Web Application Firewall) protects your web apps from common web exploits on Layer 7 OSI which is HTTP layer. It is deployed on ALB, API Gateway, CloudFront, AppSync GraphQL API, Cognito User Pool. Once deployed, Define Web ACL rules to setup rules for up to 10,000 IP address, use multiple rules for more IPs, filter based on HTTP headers, HTTP body, or use URI strings to protect from common attacks, e.g SQL injection and cross-site scripting (XSS), size constraints on requests, geo-match to block countires. Rate-limiting rules to protect from DDoS aatacks. Web ACL are regional except for CloudFront and a rule group is a resuable set of rules that can be added to web ACL. To implement WAF on a fixed IP with a loadbalancer, we need to use Global Accelerator with a fixed IP as a front (as only NLB supports fixed ips but WAF can only be attached with ALB in LBs) then attach it to an ALB, deploy WAF on ALB fronting the application.

AWS Shield Standard is used to protect from DDoS attack such as SYN/UDP floods, reflection attacks and others BUT ONLY ON LAYER 3/LAYER 4 attacks. It is a free service activated for every customer. AWS Shield Advanced is optional DDoS mitigation service which costs 3000$ per month per organization. Protects against more sophisticated attacks on EC2, ELB, CloudFront, Global Accelerator, Route 53. 24/7 access to AWS DDoS response team, protects against higher fees during usage spikes due to DDoS. Shield Advanced also auto-mitigates Layer 7 attacks by evaluating and deploying AWS WAF rules to mitigate layer 7 attacks.

AWS Firewall manager manages rules in all accounts of an AWS Organization, security policy like common sets of rules including WAF rules, AWS Shield Advanced, SG for EC2, ALB, ENI in VPC, AWS Network Firewall, Route 53. Policies are created at region level and if rules are applied for existing ALB and new one is created, same rules are applied to it as well.

So WAF alone provides granular protection of your resources, but if you have multiple accounts and need acceleration and automation of WAF configuration and protection, use Firewall manager. Shield Advanced add additional features on top of WAF, provides dedicated Shield Response teams, great if you frequently face DDoS attacks.

Amazon GuardDuty is an intelligent threat discovery to protect your AWS Account. Uses ML algorithms, anomaly detection, 3rd party data. One click to enable (30 days trial) no need to install software. Input data includes CloudTrail Event Logs (e.g unusual API calls or unauthorized deployments), CloudTrail Management events, CloudTrail S3 Data Events, VPC Flow Logs, DNS Logs, Optional features are EKS Audit Logs, RDS & Aurora, EBS, Lambda, S3 data events. Can setup EventBridge rules to be notified in case of findings, EventBridge rules can target AWS Lambda and GuardDuty protects against "Cryptocurrency attacks" (has a dedicated "finding" for it) "Both are keywords for exam".

Amazon Inspector is for automated security assessments for EC2 instances (OS). It leverages the AWS SSM agent, analyze against unintended network accessibility and analyze the running OS against known vulnerabilities. For container images pushed to ECR, it assess the container images being pushed, For Lambda functions it identifies software vulnerabilities in function code and package dependencies. Assessment of functions after their deployed as well. These reporting are then sent to AWS Security Hub and EventBridge for notifications.

Amazon Macie is a fully managed data security and privacy service using ML and Pattern matching to discover and protect your sensitive data in AWS S3 buckets. Sensitive data (PII) is identified in S3 buckets you specify in Macie and are reported/notified to you via EventBridge notifications.


NOTE: For Edge optimized API Gateway, the ACM certificate will always attach in us-east-1 because thats where the API Gateway control-plane will always be.

Also Configure EventBridge for "Daily Expiration Events" from ACM to invoke SNS notifications to your email if you want to be notified 30 days before your imported certificate expires so you can manually generate a new one.



